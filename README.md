# Wildberries парсинг информации о товарах.
API Сервис позволяет подписаться на необходимые артикулы товаров маркетплейса Wildberries. По ним будет собираться информация, доступная в отчётах. Информация собирается раз в час.

## Обзор:
### Workflow
* Зарегистрироваться.
* Добавить нужные артикулы в мониторинг.
* Смотреть отчёты по собранной информации.
 
### Стек
* Django rest framework
* PostgreSQL
* Celery
* Redis
## Установка проекта
#### Установка через docker
* Установите docker-compose

* Склонируйте репозиторий с помощью git
 ```bash
git clone https://github.com/velPavelTest/fullstatsApi.git
```

* Перейдите в папку проекта:
```bash
cd fullstatsApi
```

* Измените логины-пароли в файле .env

* Запуск и сборка контейнеров:
```bash
docker-compose up -d --build
```
**Готово**
* Запуск тестов:
```bash
python manage.py test
```

### Точки входа:
* http://localhost:8005/ - веб сервис
  * http://localhost:8005/api/ - api endpoints (см ниже)
  * http://localhost:8005/admin/ - админка
  * http://localhost:8005/api/swagger/ - swagger
* http://localhost:8080/ - веб интерфейс доступа к БД.
* http://localhost:5555/ - веб мониторинг задач (flower).

### Основные сущности
#### Подписка
* ID - ID в БД приложения.
* vendor_code - артикул товара
* user - пользователь создавший подписку

#### Запись данных о товаре
* ID - ID в БД приложения.
* vendor_code - артикул товара
* parse_time - дата и время парсинга
* name - наименование товара
* price_wo_discount - цена без скидки
* price_with_discount - цена со скидкой (если нет скидки, то равна цене без скидки)
* brand - бренд
* seller - юр. наименование поставщика товара


## API
Ознакомиться с API можно в документации сваггер.
### User
| Request                     | Description                                                                                                          |
|-----------------------------|----------------------------------------------------------------------------------------------------------------------|
| POST /api/register/         | Регистрация нового пользователя. Принимает {"username": "name", "email": "user@example.com", "password": "password"} |
| POST /api/token/            | Получить access и refresh JSON Web Tokens (JWT). Принимает {"username": "string", "password": "string"}              |
| POST /api/token/refresh/    | Обновить access токен. Принимает {"refresh": "string"}                                                               |
| GET  /api/token/testaccess/ | Проверить доступ. Требуется JWT аутентификация.                                                                      | 


### Подписки
**Все запросы требуют JWT аутентификации.**

| Request                                                                      | Description                                                                                                                                                                        |
|------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| GET  /watch/api/subscription/                                                | Получить список артикулов на которые подписан пользователь.                                                                                                                        |
| Post /watch/api/subscription/                                                | Подписаться на новый артикул. Принимает {"vendor_code": 1234567}                                                                                                                   |
| DELETE /watch/api/subscription/{vendor_code}/                                | Отписаться от артикула.                                                                                                                                                            |
| GET /watch/api/report/{vendor_code}/?start=2022-05-07&end=2022-5-7&period=24 | Запросить выгрузку по артикулу vendor_code с даты start по дату end с периодом period. Доступные значения периодов 1 (за каждый час), 2, 3, 4, 6, 8, 12, 24 (одна запись за сутки) |                                                                                                                                                              |

### Альтернативные endpoints управления подпиской
Единственная причина их существования - требование CRUD в ТЗ. Можно заметить, что endpoints "Подписки" не реализует Update (нет смысла). В этом варианте есть update. Управление идёт через id в базе, а не через артикул.
**Все запросы требуют JWT аутентификации**.

| Request                                          | Description                                                               |
|--------------------------------------------------|---------------------------------------------------------------------------|
| GET  /watch/api/alternative/subscription/        | Получить список id подписок и артикулов на которые подписан пользователь. |
| Post /watch/api/alternative/subscription/        | Подписаться на новый артикул                                              |
| GET /watch/api/alternative/subscription/{id}/    | Получить информацию о подписке по её id                                   |
| PUT /watch/api/alternative/subscription/{id}/    | Обновить артикул для подписки.                                            |
| PATCH /watch/api/alternative/subscription/{id}/  | Обновить артикул для подписки.                                            |
| DELETE /watch/api/alternative/subscription/{id}/ | Удалить подписку. По ID, не по артикулу.                                  |
